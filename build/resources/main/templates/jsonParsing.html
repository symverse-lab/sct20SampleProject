<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>jsonParsing</title>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
        
<script>
    function IsJsonString(str) {
        try {
            JSON.parse(str);
        } catch (e) {
            alert("형식이 일치하지 않습니다.");
            return false;
        }
        return true;
    }
    
    $(function(){        
        $("#btnParsing").on("click", function(){
                    
            
            var address, crypto, id, version;
            
            var inputData = $("#inputData").val();            
            
            IsJsonString(inputData);
            
            var obj = JSON.parse(inputData);
            
            $.each(obj[0], function(key, value){
            
                switch(key){
                        case "ca":
                            if(value.address==null || value.address==""){
                                alert("address가 존재하지 않습니다.");
                                return false;
                            }else{
                                address = value.address;    
                            }
                            break;

                        case "crypto":
                            if(value.cipher==null || value.cipher==""){
                                alert("cipher가 존재하지 않습니다.");                            
                                return false;
                                
                            }else if(value.ciphertext==null || value.ciphertext==""){
                                alert("ciphertext가 존재하지 않습니다.");
                                return false;                                
                                
                            }else if(value.cipherparams.iv==null || value.cipherparams.iv==""){
                                alert("cipherparams가 존재하지 않습니다.");
                                return false;                                
                                
                            }else if(value.kdf==null || value.kdf==""){
                                alert("kdf가 존재하지 않습니다.");
                                return false;
                                
                            }else if(value.kdfparams.dklen==null || value.kdfparams.dklen==""){
                                alert("dklen이 존재하지 않습니다.");
                                return false;
                                
                            }else if(value.kdfparams.n==null || value.kdfparams.n==""){
                                alert("n이 존재하지 않습니다.");
                                return false;
                                
                            }else if(value.kdfparams.p==null || value.kdfparams.p==""){
                                alert("p가 존재하지 않습니다.");
                                return false;
                                
                            }else if(value.kdfparams.r==null || value.kdfparams.r==""){
                                alert("r이 존재하지 않습니다.");
                                return false;
                                
                            }else if(value.kdfparams.salt==null || value.kdfparams.salt==""){
                                alert("salt가 존재하지 않습니다.");
                                return false;
                                
                            }else if(value.mac==null || value.mac==""){
                                alert("mac이 존재하지 않습니다.");
                                return false;
                            }else{
                                crypto = value;     
                            }
                            break;             

                        case "id":
                            if(value==null || value==""){
                                alert("id가 존재하지 않습니다.");    
                                return false;
                                
                            }else{
                                id = value;
                            }
                            break;

                        case "version":
                            if(value==null || value==""){
                                alert("version이 존재하지 않습니다."); 
                                return false;
                                
                            }else{
                                version = value;
                            }
                            break;

                }
            
            });
                          
            var resultData = {
                                "address": address, 
                                "crypto": {
                                    "cipher" : crypto.cipher,
                                    "ciphertext" : crypto.ciphertext,
                                    "cipherparams" : crypto.cipherparams,
                                    "kdf" : crypto.kdf,
                                    "kdfparams" : crypto.kdfparams,
                                    "mac" : crypto.mac
                                },
                                "id": id, 
                                "version": version
            };
            
            var result = JSON.stringify(resultData, null, 2);
            
            $("#outputData").val(result);
            
        });
        
        
    });
    
</script>


</head>
<body>

    <h2>JSON Data</h2>
    <textarea id="inputData" name="input_data" cols="100" rows="50"></textarea>
    <button id="btnParsing">변환</button>

    <h2>Result</h2>
    <textarea id="outputData" name="output_data" cols="100" rows="50"></textarea>
</body>
</html>